/* Copyright 2022 Ethan Halsall. This file is part of synaudio. https://github.com/eshaz/synaudio */
var P,t;P=this,t=function(P){const t=(P,t=4294967295,y=79764919)=>{const e=new Int32Array(256);let s,n,o,r=t;for(s=0;s<256;s++){for(o=s<<24,n=8;n>0;--n)o=2147483648&o?o<<1^y:o<<1;e[s]=o}for(s=0;s<P.length;s++)r=r<<8^e[255&(r>>24^P[s])];return r},y=(P,y=t)=>{const e=P=>new Uint8Array(P.length/2).map((t,y)=>parseInt(P.substring(2*y,2*(y+1)),16)),s=P=>e(P)[0],n=new Map;[,8364,,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,,381,,,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,,382,376].forEach((P,t)=>n.set(P,t));const o=new Uint8Array(P.length);let r,i,O,z=!1,a=0,h=42,c=P.length>13&&"dynEncode"===P.substring(0,9),l=0;c&&(l=11,i=s(P.substring(9,l)),i<=1&&(l+=2,h=s(P.substring(11,l))),1===i&&(l+=8,O=(P=>new DataView(e(P).buffer).getInt32(0,!0))(P.substring(13,l))));const f=256-h;for(let t=l;t<P.length;t++)if(r=P.charCodeAt(t),61!==r||z){if(92===r&&t<P.length-5&&c){const y=P.charCodeAt(t+1);117!==y&&85!==y||(r=parseInt(P.substring(t+2,t+6),16),t+=5)}if(r>255){const P=n.get(r);P&&(r=P+127)}z&&(z=!1,r-=64),o[a++]=r<h&&r>0?r+f:r-h}else z=!0;const p=o.subarray(0,a);if(c&&1===i){const P=y(p);if(P!==O){const t="Decode failed crc32 validation";throw console.error("`simple-yenc`\n",t+"\n","Expected: "+O+"; Got: "+P+"\n","Visit https://github.com/eshaz/simple-yenc for more information"),Error(t)}}return p},e=new WeakMap,s=String.raw`dynEncode010fe4732c5fp|o!t}|t|~P*r~t{ptnnwtpnqptÙ1Ö1OP0'S0<OO/PW/Pz0%/P ]O//P z1P1P y1//Y*1P0&//&/zPy0//P1Py1/P/PPOzy0$/P0"/Py0/POz0 //zPz1PZ0!/Py1//&zy0O/0/0O////y1ó///ó/////ó///?/?ó?/POz0/Pz1O//[/0O/!T/ /"/#{1y/$X//$y/ Z/ 0/0O///y/ó/Py0/Py1/0/&T//Py0O///y9/9¡G/Py0//Py1Y//"y0/#Py1#/%V/P[//P1 y/Z//PPz/{y/ZP/PX0/P0/P?y0$/P/y0"/Py0!//'0OP0O/TO////#{P1y/óO/PU/!//!y/!ó/PU/"//"y/"ó/PU/$//$y/$ó//1U/0/O//y0//Py0/0O///y9/9¡G/Py0/Pz1//zPZ//z0//Py0O///y19/9¡G//9/9¡G//9/9¡G//9/9¡G/Py0/Pz1// y0/#Py1#/%VO/PW/Pz0$/P ]O//P z1P1P y1//W*1P0%//%/zPy0//P1Py1/P/PPOzy0"/P0!/Py0/POz0P0//zPz1PZ0 /Py1//%zy0P0#O/0/0O////y1ó///ó/////ó///?/?ó?/POz0/Pz1O//[/0O/ T//!/#{1y/"X//"y/Z/0/0O///y/ó/Py0/Py1/0/%T//Py0O///y9/9¡G/Py0//Py1Y//!y0/#Py1#/$V/P[//P1y/Z//PPz/{y/ZP/PX0/P0/P?y0"/P/y0!/Py0 //'0P0P0#OP0O/TO////#{P1y/óO/PU/ // y/ ó/PU/!//!y/!ó/PU/"//"y/"ó//1U/0/O//y0//Py0/0O///y9/9¡G/Py0/Pz1//zPZ//z0//Py0O///y19/9¡G//9/9¡G//9/9¡G//9/9¡G/Py0/Pz1//y0/#Py1#/$VP0!/PE/PE/PYO/P0O/Pz1PXOP0/0//'10O/8/9Ê¯/9Ê¯/9Ê¯/9Ê¯08/Py0/Pz1/O//Py0/0O/8/9Ê¯08/Py0/Pz1O/PXOP0/0//'10O/9/9Ê¯/9Ê¯/9Ê¯/9Ê¯09/Py0/Pz1/O//Py0O/9/9Ê¯09/Py0/Pz1/Pz0/9/Æ19²Å0)P/P W)/)"04P0/0O/1//4ô12/2õó//4ô12/2õó///4ô12/2õó/?/4ô12/2õó01/POz0//Py1YP0!/P zPPy/Pz0/</Æ19²Å0)P0/1./1./1./1.¡¡¡0*O//]//zP1//Py0/0O/9/)¢1(/(£/*¡0*/Py0/Pz1//y/0//zPZ//z0//Py0O/9/)¢1(/(£/9/)¢1(/(£/9/)¢1(/(£/9/)¢1(/(£/*¡¡¡¡0*/Py0/Pz1P0/!O/)"02/0O///2ô///2ô////2ô///?/2ô?/POz0//Py1Y/*/ÁRÎ¡1.¤0(//z0 O//[///z1PZ//Py0/)"02/P10O///2ô/Py0/Pz1//U//y/1z0//Py0O//9/)¢G/Py0/Pz1/( 0,/ PYO/P0/Pz0/P zPPy0/90)/,Ê0:P0/0O//Py1900/8/9²Å0//!TO0103P//"05P0P00301O/3//y1/5ô16//y1õó//5ô17/õó///5ô14//õó/?/5ô12/?õó03/1/6/6õó/7/7õó/4/4õó/2/2õó01/POz0//Py1Y/0/1./1./1./1.¡¡¡0*/3./3./3./3.¡¡¡0+O//]//zP//P1y9//¢1(//y9£/+¡0+/(/(£/*¡0*/Py/0//U/P0//z0O//y19//¢1-//y19£/9//¢1(/9£/+¡¡0+/-/-£/(/(£/*¡¡0*/Py0/Pz1//Py9Ê0;/)/+/.¤Ê/*/.¤Ê®/:±²Å1(l//E//(G/(/)0)/8/0Ê°/;¯08//y0//y1/ WO/P[/71//{1y1/ // W*0P0//z1P/PY*0O/P[O/<08/P0O/PzPXO/<08//Py0/<08//'10O/8/9Ê¯/9Ê¯/9Ê¯/9Ê¯08/Py0/Pz1/T//P/Pyy0O/8/9Ê¯08/Py0/Pz1//]/Pz0//Py0/P zPPy0/90)/,Ê0:O//Py1900/8/9²Å0,/!TO0103P/,"05P0/0/00301O/3//5ô16/õó//5ô17/õó///5ô14//õó/?/5ô12/?õó03/1/6/6õó/7/7õó/4/4õó/2/2õó01/POz0/POz0//Py1Y/0/1./1./1./1.¡¡¡0*/3./3./3./3.¡¡¡0+O//]//zP//P1y9/,¢1(//y9£/+¡0+/(/(£/*¡0*/Py/0//U/P0//z0O//y19/,¢1-//y19£/9/,¢1(/9£/+¡¡0+/-/-£/(/(£/*¡¡0*/Py0/Pz1//Py9Ê0;/)/+/.¤Ê/*/.¤Ê®/:±²Å1(l//E//(G/(/)0)/8/0Ê°/;¯08/Py0/Py1/VZpvtnutpt:p~|xr:|pq{t<v{~qp{:x|s@AG:q{z<|t|~:xv}<t`,n=String.raw`dynEncode010f317f7943p|,ooot}|t|~P*r~t{ptnnwtpnqptà ¡O/PW/Pz0/P]O/Pz0/P0/Py10O/0/0/0P0O///y19/9¡G//9/9¡G//9/9¡G//9/9¡G/1Py0/1Py0/Py0//Py1Y//YOO//9/9¡G/Py0/Py0//Py1Y//y0//y0/Py1/V/P[/P0/90/PU0/PU0/0O//9/¡1GO///9/9¡G/PU//9/9¡G///9/9¡G//y0/Pz1O/1PWP/Pz0/Pz0O//y19/¢1//y19£/9/¢1/9£/9/¢1/9£/9/¢1/9£/¡¡¡¡0//£//£//£//£/¡¡¡¡0/Py0//Py1Y/PPy1/]//zP//P1y9/¢1//y9£/¡0//£/¡0/Py/0/Pz/U//z0//P1y0//y0O/9/¢1/£/9/¢1/£/¡¡0//9£//9£/¡¡0/Py0/Py0/Pz1//ÁRÎ¡1¤Ê//¤Ê®/Ê±²ÅÁOP0S0%O///////PE/PE/PYO/P0/Pz1P^O/0//10O/!/9Ê¯/9Ê¯/9Ê¯/9Ê¯0!/Py0/Pz1/O/P/y0/0O/!/9Ê¯0!/Py0/Pz1/P^O/0//10O/"/9Ê¯/9Ê¯/9Ê¯/9Ê¯0"/Py0/Pz1/O/P/y0O/"/9Ê¯0"/Py0/Pz1/Pz0/Á0 /PWOP0P/"Å/ ¤0P0/0O/9/¢1/£/9/¢1/£/9/¢1/£/9/¢1/£/¡¡¡¡0/Py0/Py1/WP0/PzPPy/Pz0/Á0 P0/"/Æ1"²Å0O//]//zP1/P/y0/0O/9/¢1/£/¡0/Py0/Pz1//y/0//zPZ//z0/P/y0O/9/¢1/£/9/¢1/£/9/¢1/£/9/¢1/£/¡¡¡¡0/Py0/Pz1P0/O/0O//9/¢G//9/¢G//9/¢G//9/¢G/Py0/Py1/W// RÎ¡¤0//z0O//]/0//zP1O//y0/P/y0O//9/¢G/Py0/Pz1//zPZ//z0/P/y0O//9/¢G//9/¢G//9/¢G//9/¢G/Py0/Pz1/ 0O/P[OP0/P0/P0P0/0P0O/!/9Ê°0#//y9Ê0$/90///!/"²Å//1 /m//E// G//0/#/$¯0!//y0//y1/WO/P[///{1y1///W*0P0//z1P/PY*0O/P[O/%0!/P0O/PzPXO/%0!/P/y0/%0!//10O/!/9Ê¯/9Ê¯/9Ê¯/9Ê¯0!/Py0/Pz1/T/P/Py/y0O/!/9Ê¯0!/Py0/Pz1//]/P0/P/y0O/!/9Ê°0#//y9Ê0$/90///!/"²Å//1 /mO//E// G/#/$¯0!/Py0/Py1/V;pvtnutpt:|pq{t<v{~qp{:xv}<t`;class o{constructor(t={}){this.P=t.correlationSampleSize>0?t.correlationSampleSize:11025,this.t=t.initialGranularity>0?t.initialGranularity:16,this.o=t.i>=0?t.i:.5,this.O=e.get(o),this.O||(this.O=(async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])))().then(P=>P?WebAssembly.compile(y(s)):WebAssembly.compile(y(n))),e.set(this.O)),this.h=this.O.then(()=>WebAssembly.instantiate(module,{})).then(P=>P.exports.__heap_base.value),this.l=function t(y,e,s,n){this.p=new Map,this.m=(P,t)=>Math.min(P.samplesDecoded,t.samplesDecoded,this.P),this.u=(P,t)=>Math.min(P.samplesDecoded,t.samplesDecoded,this.t),this.G=(P,t,y)=>{const e=t.BYTES_PER_ELEMENT;let s=y/e;for(let n=0;n<P.length;n++)y+=P[n].length*e,t.set(P[n],s),s+=P[n].length;return y},this.W=(y,e)=>{let s=this.p.get(y);if(!s){let P,e="text/javascript",n=`'use strict';(${""+((P,t,y,e)=>{self.onmessage=s=>{new P(Promise.resolve(s.data.module),y,e).M.get(t).apply(null,s.data.$).then(P=>{self.postMessage(P)})}})})(${""+t}, "${y}", ${this.P}, ${this.t})`;try{P=void 0!==process.versions.node}catch{}s=P?`data:${e};base64,${Buffer.from(n).toString("base64")}`:URL.createObjectURL(new Blob([n],{type:e})),this.p.set(y,s)}const n=new(globalThis.Worker||P)(s,{name:"SynAudio"}),o=new Promise(P=>{n.onmessage=t=>{n.terminate(),P(t.data)}});return this.O.then(P=>{n.postMessage({module:P,$:e})}),o},this.U=(P,t,y,e,s,n,o,r,i,O,z)=>this.O.then(t=>WebAssembly.instantiate(t,{env:{memory:P}})).then(({exports:a})=>{const h=new Map(Object.entries(a)),c=h.get("correlate"),l=new DataView(P.buffer),f=h.get("__heap_base").value;return console.log("heap base",f),c(t+f,y,e,s+f,n,o,r,i,O+f,z+f),{correlation:l.getFloat32(O+f,!0),sampleOffset:l.getInt32(z+f,!0)}}),this.T=(P,t)=>{const y=Float32Array.BYTES_PER_ELEMENT,e=(P.samplesDecoded*P.channelData.length*y+t.samplesDecoded*t.channelData.length*y+2*y)/65536+4,s=new WebAssembly.Memory({initial:e,A:e,Y:!0}),n=new Float32Array(s.buffer);return this.h.then(e=>{const o=e,r=this.G(P.channelData,n,o),i=this.G(t.channelData,n,r),O=i+y,z=this.m(P,t),a=this.u(P,t);return this.U(s,o,P.samplesDecoded,P.channelData.length,r,t.samplesDecoded,t.channelData.length,z,a,i,O)})},this.Z=(P,t)=>this.h.then(y=>{const e=Float32Array.BYTES_PER_ELEMENT,s=y,n=(P.samplesDecoded*P.channelData.length*e+t.reduce((P,t)=>t.samplesDecoded*t.channelData.length*e+P,0)+t.length*(2*e))/65536+4,o=new WebAssembly.Memory({initial:n,A:n,Y:!0}),r=new Float32Array(o.buffer);let i=this.G(P.channelData,r,s);return Promise.all(t.map(t=>{const y=this.G(t.channelData,r,i),n=y+e,O=n+e,z=this.m(P,t),a=this.u(P,t),h=this.W("_syncWasmMemory",[o,y,n,s,P.samplesDecoded,P.channelData.length,i,t.samplesDecoded,t.channelData.length,z,a]);return i=O,h}))}),this.v=(P,t,y)=>{const e=[],s=[0],n=this.m(P,t),o=Math.log(P.samplesDecoded*n)/Math.log(this.t+1)*Math.log(n/1e4+1);y=Math.max(Math.round(Math.min(y,o,P.samplesDecoded/n/4)),1);const r=Math.ceil(P.samplesDecoded/y);let i=0;for(let O=0;O<y;O++){const y={channelData:[]};for(let t=0;t<P.channelData.length;t++){const e=P.channelData[t].subarray(i,i+r+n);y.channelData.push(e),y.samplesDecoded=e.length}i+=r-n,s.push(i),e.push(this._(y,t))}return Promise.all(e).then(P=>{let t=0,y=-1;for(let e=0;e<P.length;e++)P[e].correlation>y&&(t=e,y=P[e].correlation);return{correlation:P[t].correlation,sampleOffset:P[t].sampleOffset+s[t]}})},this.V=(P,t)=>this.W("_syncOneToMany",[P,t]),this._=(P,t)=>this.W("_sync",[P,t]),this.k=(P,t,y)=>globalThis.Worker?this.W("_syncWorkerConcurrent",[P,t,y]):this.v(P,t,y),this.M=new Map([["_sync",this.T],["_syncWasmMemory",this.U],["_syncOneToMany",this.Z],["_syncWorker",this._],["_syncWorkerConcurrent",this.v]]),this.O=y,this.h=e,this.P=s,this.t=n},this.S=new this.l(this.O,this.h,this.P,this.t)}async syncWorkerConcurrent(P,t,y){return this.S.k(P,t,y>=1?y:1)}async syncWorker(P,t){return this.S._(P,t)}async sync(P,t){return this.S.T(P,t)}async q(P,t){return this.S.V(P,t)}async X(P,t){return this.S.Z(P,t)}async syncMultiple(P,t){t=t>=1?t:8;const y=[],e=[];let s=()=>{},n=Promise.resolve(),o=0;const r=()=>{n=new Promise(P=>{s=P})};for(let f=0;f<P.length;f++)e.push({vertex:{}});for(let f=0;f<P.length;f++){const i=P[f],O=e[f].vertex;O.name=i.name,O.samplesDecoded=i.data.samplesDecoded,O.D=new Set;for(let z=0;z<P.length;z++){if(f===z)continue;const a=P[z],h=e[z];o++,y.push(this.syncWorker(i.data,a.data).then(P=>{P.correlation>this.o&&O.D.add({parent:O,vertex:h.vertex,samplesDecoded:a.data.samplesDecoded,...P}),o--,s()})),o>=t&&(r(),await n)}}await Promise.all(y);const i=(P,t)=>P.parent&&t.parent&&P.parent.samplesDecoded!==t.parent.samplesDecoded?P.parent.samplesDecoded>t.parent.samplesDecoded:P.correlation!==t.correlation?P.correlation>t.correlation:P.sampleOffset!==t.sampleOffset?P.sampleOffset>t.sampleOffset:P.vertex&&t.vertex&&P.vertex.name.localeCompare(t.vertex.name)<0,O=new Map,z=new Set,a=P=>{for(const t of P.D.values()){if(O.has(P))return O.get(P);O.set(P,t);const y=a(t.vertex),e=t;if(y){let P,t;i(y,e)?(P=y,t=e):(P=e,t=y),t.F||(t.F=new Set,z.add(t)),t.F.add(P),P.F&&P.F.delete(t)}O.delete(P)}};for(const{vertex:f}of e)a(f);for(const f of z)f.F.size&&f.parent.D.delete(f);const h=new Set;for(const f of e)h.add(f.vertex);for(const f of e)for(const P of f.vertex.D)h.delete(P.vertex);const c=(P,t,y,e=0)=>{for(const s of y)P.has(s.vertex)&&i(P.get(s.vertex),s)||P.set(s.vertex,{name:s.vertex.name,correlation:s.correlation,sampleOffset:e+s.sampleOffset}),c(P,t,s.vertex.D,e+s.sampleOffset)},l=[];for(const f of h){const P=new Map;P.set(f,{name:f.name,sampleOffset:0}),c(P,f,f.D),l.push([...P.values()].sort((P,t)=>P.sampleOffset-t.sampleOffset||(P.correlation||0)-(t.correlation||0)||t.name.localeCompare(P.name)))}return l}}return o},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@eshaz/web-worker")):"function"==typeof define&&define.amd?define(["@eshaz/web-worker"],t):(P="undefined"!=typeof globalThis?globalThis:P||self).SynAudio=t(P.Worker);
//# sourceMappingURL=synaudio.min.js.map